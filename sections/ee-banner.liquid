{% comment %}
  EcomExperts Test – Custom Banner Section (no jQuery)
  - Mobile: hamburger (☰) toggles drawer with tagline + CTA
  - Mobile hero: text on white first, image below with overlaid SHOP NOW
  - Desktop: smaller title/subtitle per assignment
{% endcomment %}

<section id="ee-banner-{{ section.id }}" class="ee-banner">
  <div class="ee-banner__topbar">
    <button
      class="ee-hamburger"
      aria-expanded="false"
      aria-controls="ee-mobile-drawer-{{ section.id }}"
      aria-label="Open menu"
    >
      <span class="ee-hamburger__bar"></span>
    </button>

    <div class="ee-banner__brand">{{ section.settings.brand_text }}</div>
    <div class="ee-banner__tagline">{{ section.settings.tagline }}</div>

    {% if section.settings.top_cta_text != blank %}
      <a class="ee-btn ee-btn--top" href="{{ section.settings.top_cta_link | default: '#' }}">
        <span>{{ section.settings.top_cta_text }}</span>
        <span class="ee-arrow" aria-hidden="true">→</span>
      </a>
    {% endif %}
  </div>

  <!-- Mobile dropdown under topbar -->
  <div id="ee-mobile-drawer-{{ section.id }}" class="ee-mobile-drawer" aria-hidden="true">
    <p class="ee-mobile-tagline">{{ section.settings.tagline }}</p>
    {% if section.settings.top_cta_text != blank %}
      <a class="ee-btn ee-btn--top" href="{{ section.settings.top_cta_link | default: '#' }}">
        <span>{{ section.settings.top_cta_text }}</span>
        <span class="ee-arrow" aria-hidden="true">→</span>
      </a>
    {% endif %}
  </div>

  <div
    class="ee-banner__hero"
    role="img"
    aria-label="{{ section.settings.bg_alt | escape }}"
    {% if section.settings.bg_image %}
      style="--bg:url({{ section.settings.bg_image | image_url }})"
    {% endif %}
  >
    <!-- Text block -->
    <div class="ee-banner__inner">
      <h1 class="ee-banner__title">{{ section.settings.title }}</h1>
      {% if section.settings.subtitle != blank %}
        <p class="ee-banner__subtitle">{{ section.settings.subtitle }}</p>
      {% endif %}
      {% if section.settings.main_cta_text != blank %}
        <a class="ee-btn ee-btn--primary" href="{{ section.settings.main_cta_link | default: '#' }}">
          <span>{{ section.settings.main_cta_text }}</span>
          <span class="ee-arrow" aria-hidden="true">→</span>
        </a>
      {% endif %}
    </div>

    <!-- Mobile-only image with overlaid button -->
    <div class="ee-hero-img" aria-hidden="true">
      {% if section.settings.bg_image %}
        {% if section.settings.bg_image %}
          {{
            section.settings.bg_image
            | image_url: width: 1600
            | image_tag:
              widths: '400,800,1200,1600',
              sizes: '(min-width: 990px) 1600px, 100vw',
              alt: section.settings.bg_alt,
              class: 'ee-hero-img__img',
              loading: 'lazy'
          }}
        {% endif %}
      {% endif %}
      {% if section.settings.main_cta_text != blank %}
        <a
          class="ee-btn ee-btn--primary ee-btn--mobile-overlay"
          href="{{ section.settings.main_cta_link | default: '#' }}"
        >
          <span>{{ section.settings.main_cta_text }}</span>
          <span class="ee-arrow" aria-hidden="true">→</span>
        </a>
      {% endif %}
    </div>
  </div>

  {% if section.settings.bottom_strip != blank %}
    <div class="ee-banner__strip">
      <span>{{ section.settings.bottom_strip }}</span>
    </div>
  {% endif %}
</section>

<style>
    /* ---- Scoped styles ---- */
    #ee-banner-{{ section.id }} {
      --max: 1200px;
      --pad: 20px;
      --black: #111;
      --white: #fff;
      --accent: #FCEB00;
      --gray: #efefef;
    }

    /* Top bar */
    #ee-banner-{{ section.id }} .ee-banner__topbar{
      display:grid; grid-template-columns:auto 1fr auto; align-items:center;
      gap:16px; background:#f3f3f3; padding:10px var(--pad); font-weight:600;
    }
    #ee-banner-{{ section.id }} .ee-banner__brand{ justify-self:start; }
    #ee-banner-{{ section.id }} .ee-banner__tagline{ justify-self:center; text-align:center; }
    #ee-banner-{{ section.id }} .ee-banner__topbar .ee-btn--top{ justify-self:end; width:max-content; white-space:nowrap; }

    /* Hamburger */
    #ee-banner-{{ section.id }} .ee-hamburger{ display:none; position:relative; width:32px; height:28px; background:transparent; border:none; padding:0; cursor:pointer; }
    #ee-banner-{{ section.id }} .ee-hamburger__bar,
    #ee-banner-{{ section.id }} .ee-hamburger__bar::before,
    #ee-banner-{{ section.id }} .ee-hamburger__bar::after{
      content:""; position:absolute; left:0; right:0; height:2px; background:#000;
      transition: transform .25s ease, opacity .2s ease, top .25s ease, bottom .25s ease;
    }
    #ee-banner-{{ section.id }} .ee-hamburger__bar{ top:50%; transform:translateY(-50%); }
    #ee-banner-{{ section.id }} .ee-hamburger__bar::before{ top:-8px; }
    #ee-banner-{{ section.id }} .ee-hamburger__bar::after{ bottom:-8px; }
    #ee-banner-{{ section.id }} .ee-hamburger[aria-expanded="true"] .ee-hamburger__bar{ background:transparent; }
    #ee-banner-{{ section.id }} .ee-hamburger[aria-expanded="true"] .ee-hamburger__bar::before{ top:0; transform:rotate(45deg); }
    #ee-banner-{{ section.id }} .ee-hamburger[aria-expanded="true"] .ee-hamburger__bar::after{ bottom:0; transform:rotate(-45deg); }

    /* Buttons – base */
    #ee-banner-{{ section.id }} .ee-btn{
      position:relative; overflow:hidden; isolation:isolate;
      display:inline-flex; align-items:center; gap:.5rem;
      padding:.55rem 1.2rem; text-decoration:none; line-height:1; cursor:pointer;
      border:none; outline:none; width:max-content; white-space:nowrap;
    }
    #ee-banner-{{ section.id }} .ee-btn::before{
      content:""; position:absolute; inset:0; transform:scaleX(0);
      transform-origin:left; transition:transform .6s ease; z-index:-1;
    }
    #ee-banner-{{ section.id }} .ee-btn:hover::before{ transform:scaleX(1); }
    #ee-banner-{{ section.id }} .ee-btn--top{ background:var(--accent); color:#000; font-weight:600; }
    #ee-banner-{{ section.id }} .ee-btn--top::before{ background:#000; }
    #ee-banner-{{ section.id }} .ee-btn--top:hover{ color:#fff; }
    #ee-banner-{{ section.id }} .ee-btn--primary{ background:#000; color:#fff; padding:.65rem 1.3rem; }
    #ee-banner-{{ section.id }} .ee-btn--primary::before{ background:var(--accent); }
    #ee-banner-{{ section.id }} .ee-btn--primary:hover{ color:#000; }

    /* Arrow blink */
    @keyframes arrow-blink { 0%,100%{opacity:1;} 50%{opacity:0;} }
    #ee-banner-{{ section.id }} .ee-btn .ee-arrow{ margin-left:.4rem; display:inline-block; }
    #ee-banner-{{ section.id }} .ee-btn:hover .ee-arrow{ animation:arrow-blink .8s infinite; }

    /* Mobile drawer */
    #ee-banner-{{ section.id }} .ee-mobile-drawer{ display:none; overflow:hidden; max-height:0; transition:max-height .3s ease, padding .3s ease; background:#fff; padding:0 var(--pad); text-align:center; box-shadow:0 0 0 transparent; }
    #ee-banner-{{ section.id }}.menu-open .ee-mobile-drawer{ max-height:220px; padding:14px var(--pad) 18px; box-shadow:0 2px 0 #e8e8e8; }
    #ee-banner-{{ section.id }} .ee-mobile-tagline{ margin:0 0 12px; font-weight:600; }

    /* Hero (desktop) */
    #ee-banner-{{ section.id }} .ee-banner__hero{
      background: var(--white);
      background-image: var(--bg);
      background-size: cover; background-position: center 40%;
      min-height: 520px;
      display:flex; align-items:flex-end; justify-content:center; position:relative;
    }
    #ee-banner-{{ section.id }} .ee-banner__inner{
      width:100%; max-width:var(--max);
      padding: 36px var(--pad) 56px;
      text-align:left;
    }
    /* Desktop smaller */
    #ee-banner-{{ section.id }} .ee-banner__title{ font-size: clamp(54px, 4vw, 36px); line-height:1.1; margin:.2em 0 .1em; }
    #ee-banner-{{ section.id }} .ee-banner__subtitle{ max-width: 32vw; font-size: .85rem; line-height:1.5; color:#333;font-weight: 700; }

    /* Mobile image container (hidden on desktop) */
    #ee-banner-{{ section.id }} .ee-hero-img{ display:none; }

    /* Bottom strip */
    #ee-banner-{{ section.id }} .ee-banner__strip{
      display:flex; justify-content:center; align-items:center;
      background:#eee; font-size:.78rem; padding:8px 12px; border-top:1px solid #ddd; letter-spacing:.06em;font-weight: 700;
    }

      /* Desktop subtitle – show full */
      #ee-banner-{{ section.id }} .ee-banner__subtitle{
          overflow: visible;
          text-overflow: initial;
          -webkit-line-clamp: unset;
          -webkit-box-orient: unset;
      }


    /* ---------- Mobile ---------- */
    @media (max-width: 768px){
      /* Header */
      #ee-banner-{{ section.id }} .ee-hamburger{ display:block; }
      #ee-banner-{{ section.id }} .ee-banner__brand{ justify-self:center; }
      #ee-banner-{{ section.id }} .ee-banner__tagline,
      #ee-banner-{{ section.id }} .ee-banner__topbar .ee-btn--top{ display:none; }
      #ee-banner-{{ section.id }} .ee-mobile-drawer{ display:block; }
      #ee-banner-{{ section.id }} .ee-banner__topbar{ grid-template-columns: auto 1fr auto; font-size:1rem; padding: 12px var(--pad); }

      /* Text on white first */
      #ee-banner-{{ section.id }} .ee-banner__hero{ background:none; min-height:auto; align-items:stretch;flex-direction: column; }
      #ee-banner-{{ section.id }} .ee-banner__inner{ text-align:center; padding: 22px var(--pad) 12px; background:#fff; }
      #ee-banner-{{ section.id }} .ee-banner__title{ font-size: 1.7rem; margin-bottom:.45rem; }
      #ee-banner-{{ section.id }} .ee-banner__subtitle{ font-size:.95rem; max-width: 92%; margin:0 auto .8rem; }

      /* Hide desktop button */
      #ee-banner-{{ section.id }} .ee-banner__inner .ee-btn--primary{ display:none; }

      /* Image below with overlay button */
      #ee-banner-{{ section.id }} .ee-hero-img{
        display:block; width:100%; height: 260px;
        position:relative; overflow:hidden;
        background-image: var(--bg);           /* in case <img> fails */
        background-size: cover; background-position:center;
        border-top: 1px solid #eee;
      }
      #ee-banner-{{ section.id }} .ee-hero-img__img{
        position:absolute; inset:0; width:100%; height:100%;
        object-fit:cover; display:block; z-index:0;
      }
      #ee-banner-{{ section.id }} .ee-btn--mobile-overlay{
        position:absolute; left:50%; transform:translateX(-50%);
        bottom:16px; z-index:1;
        max-width: calc(100vw - 32px); /* keep inside viewport */
      }

      /* Strip tighter */
      #ee-banner-{{ section.id }} .ee-banner__strip{ font-size:.7rem; padding:6px 8px; }

      #ee-banner-{{ section.id }} .ee-banner__subtitle{
          display: -webkit-box;
          -webkit-box-orient: vertical;
          -webkit-line-clamp: 2;   /* show only 2 lines */
          overflow: hidden;
          text-overflow: ellipsis;
      }
      #ee-banner-{{ section.id }} .ee-banner__strip span{
          -webkit-box-orient: vertical;
          -webkit-line-clamp: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          display: -webkit-box;
      }
    }

    /* ---- Fluid, responsive type for the whole banner ---- */
  #ee-banner-{{ section.id }}{
    /* min -> fluid -> max */
    --fs-brand:     clamp(14px, 1.6vw, 18px);
    --fs-tagline:   clamp(12px, 1.4vw, 16px);
    --fs-title:     clamp(26px, 5.5vw, 36px);   /* smaller desktop per brief */
    --fs-subtitle:  clamp(13px, 1.6vw, 15px);   /* readable but compact */
    --fs-btn:       clamp(12px, 1.2vw, 14px);
    --fs-strip:     clamp(11px, 1.1vw, 13px);
  }

  /* Apply the scales */
  #ee-banner-{{ section.id }} .ee-banner__brand{ font-size: var(--fs-brand); }
  #ee-banner-{{ section.id }} .ee-banner__tagline{ font-size: var(--fs-tagline); }

  #ee-banner-{{ section.id }} .ee-banner__title{
    font-size: var(--fs-title) !important;      /* override earlier size */
    line-height: 1.1;
  }

  #ee-banner-{{ section.id }} .ee-banner__subtitle{
    font-size: var(--fs-subtitle) !important;
  }

  /* Buttons */
  #ee-banner-{{ section.id }} .ee-btn{
    font-size: var(--fs-btn);
  }

  /* Bottom strip */
  #ee-banner-{{ section.id }} .ee-banner__strip{
    font-size: var(--fs-strip) !important;
  }

  /* Keep mobile two-line clamp for subtitle (your existing rules) */
  @media (max-width: 768px){
    #ee-banner-{{ section.id }} .ee-banner__subtitle{
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 2;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
</style>

<script>
  /* Toggle the inline mobile dropdown and morph hamburger */
  document.addEventListener('DOMContentLoaded', function () {
    var root = document.querySelector('#ee-banner-{{ section.id }}');
    if (!root) return;
    var hb = root.querySelector('.ee-hamburger');
    var drawer = root.querySelector('#ee-mobile-drawer-{{ section.id }}');
    if (!hb || !drawer) return;

    hb.addEventListener('click', function () {
      var expanded = hb.getAttribute('aria-expanded') === 'true';
      hb.setAttribute('aria-expanded', expanded ? 'false' : 'true');
      drawer.setAttribute('aria-hidden', expanded ? 'true' : 'false');
      root.classList.toggle('menu-open', !expanded);
    });
  });
</script>

{% schema %}
{
  "name": "EE • Banner",
  "tag": "section",
  "settings": [
    { "type": "text", "id": "brand_text", "label": "Brand (top-left)", "default": "TISSO VISION" },
    {
      "type": "text",
      "id": "tagline",
      "label": "Top center tagline",
      "default": "Find the ideal gift for your loved ones."
    },
    { "type": "text", "id": "top_cta_text", "label": "Top right button text", "default": "CHOOSE GIFT" },
    { "type": "url", "id": "top_cta_link", "label": "Top right button link" },

    { "type": "text", "id": "title", "label": "Main Title", "default": "The Gift Guide" },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtitle paragraph",
      "default": "Discover Joy: Your Ultimate Holiday Gift Destination. Explore our curated selection and find the perfect gifts to delight your loved ones this holiday season."
    },
    { "type": "text", "id": "main_cta_text", "label": "Main CTA text", "default": "SHOP NOW" },
    { "type": "url", "id": "main_cta_link", "label": "Main CTA link" },

    { "type": "image_picker", "id": "bg_image", "label": "Background image (hero)" },
    { "type": "text", "id": "bg_alt", "label": "Background image alt", "default": "Gift guide background" },

    {
      "type": "text",
      "id": "bottom_strip",
      "label": "Bottom strip text",
      "default": "SUSTAINABLE, ETHICALLY MADE CLOTHES IN SIZES XXS TO 6XL"
    }
  ],
  "presets": [{ "name": "EE • Banner" }]
}
{% endschema %}
